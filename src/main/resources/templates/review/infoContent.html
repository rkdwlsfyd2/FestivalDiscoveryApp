<!-- 더이상 안쓰는 html -하요한- -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <!-- 정보창 내용 템플릿 fragment -->
    <!-- 축제 정보창 템플릿 -->
    <div th:fragment="festivalInfo(festival)">
        <div style="padding:15px; min-width:200px;">
            <h3 style="margin:0 0 10px 0; font-size:18px; font-weight:bold; color:#333;">
                <span th:text="${festival.name}">축제명</span>
            </h3>
            <p style="margin:5px 0; color:#666; font-size:14px;">
                <strong>주소:</strong> <span th:text="${festival.address}">주소</span>
            </p>
            <p style="margin:5px 0; color:#666; font-size:14px;" th:if="${festival.period}">
                <strong>기간:</strong> <span th:text="${festival.period}">기간</span>
            </p>
            <p style="margin:10px 0 0 0; color:#888; font-size:12px;" th:if="${festival.description}">
                <span th:text="${festival.description}">설명</span>
            </p>
        </div>
    </div>

    <!-- 기본 정보창 템플릿 (데이터 없이 사용) -->
    <div th:fragment="defaultInfo(title, address)">
        <div style="padding:15px; min-width:200px;">
            <h3 style="margin:0 0 10px 0; font-size:18px; font-weight:bold; color:#333;">
                <span th:text="${title}">제목</span>
            </h3>
            <p style="margin:5px 0; color:#666; font-size:14px;">
                <span th:text="${address}">주소</span>
            </p>
        </div>
    </div>
    
    <!-- JavaScript 함수: 네이버맵 정보창 HTML 생성 -->
    <th:block th:fragment="script">
    <script type="text/javascript">
        function createInfoWindowContent(festival) {
            // 기간 텍스트 생성
            let periodText = '';
            if (festival.startDate && festival.endDate) {
                const startDate = new Date(festival.startDate);
                const endDate = new Date(festival.endDate);
                if (!isNaN(startDate.getTime()) && !isNaN(endDate.getTime())) {
                    periodText = `<p style="margin:5px 0; color:#666; font-size:14px;"><strong>기간:</strong> ${startDate.toLocaleDateString('ko-KR')} ~ ${endDate.toLocaleDateString('ko-KR')}</p>`;
                }
            }
            
            // 정보창 HTML 생성
            const infoContent = `
                <div style="padding:15px; min-width:200px; box-shadow:none;">
                    <h3 style="margin:0 0 10px 0; font-size:18px; font-weight:bold; color:#333;">
                        ${festival.name || '축제명 없음'}
                    </h3>
                    <p style="margin:5px 0; color:#666; font-size:14px;">
                        <strong>주소:</strong> ${festival.address || '주소 없음'}
                    </p>
                    ${periodText}
                </div>
            `;
            return infoContent;
        }
        
        // 정보창 생성 함수
        function createInfoWindow(festival, marker, map, infoWindows) {
            // 정보창 HTML 내용 생성
            const infoContent = createInfoWindowContent(festival);
            
            // InfoWindow 생성
            const infowindow = new naver.maps.InfoWindow({
                content: infoContent,
                anchorSize: new naver.maps.Size(15, 5),
                pixelOffset: new naver.maps.Point(0, -10),
                shadow: false
            });
            
            // 마커 클릭 이벤트 리스너 등록
            naver.maps.Event.addListener(marker, "click", function() {
                // 다른 모든 정보창 닫기
                if (infoWindows && Array.isArray(infoWindows)) {
                    infoWindows.forEach(function(iw) {
                        iw.close();
                    });
                }
                // 현재 정보창 토글 (열려있으면 닫고, 닫혀있으면 열기)
                if (infowindow.getMap()) {
                    infowindow.close();
                } else {
                    infowindow.open(map, marker);
                }
            });
            
            return infowindow;
        }
    </script>
    </th:block>
</body>
</html>
