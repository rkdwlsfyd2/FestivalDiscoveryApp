<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
</head>
<body>
    <!-- 축제 목록 표시 영역 (Thymeleaf fragment) -->
    <div th:fragment="festivalList">
        <!-- 마커 업데이트용 JSON 데이터 (숨겨진 script 태그) -->
        <script th:inline="javascript" style="display:none;">
            window.ajaxFestivalsJson = /*[[${festivalsJson}]]*/ '[]';
        </script>
        <div class="w-full h-full">
            <div id="festivalListContainer" class="mb-8 overflow-y-auto overflow-x-hidden"
                style="height: 450px; max-height: 500px; box-sizing: border-box;">
                <div class="festival-items space-y-4 pr-2">
                    <!-- 실제 데이터로 축제 카드들 생성 -->
                    <div th:if="${festivalList == null or festivalList.empty}" class="text-center text-gray-500 py-8">
                        <p>등록된 축제가 없습니다.</p>
                    </div>
                    <div th:each="festival : ${festivalList.content}"
                        class="festival-card bg-white rounded-lg p-4 cursor-pointer border-l-4 border-main"
                        th:data-lat="${festival.mapy}" th:data-lng="${festival.mapx}">
                        
                        <!-- 축제 이미지 표시 : 축제 이미지가 
                         3장있으면 두번째 이미지(포스터)를 표시.
                         없으면 첫번째 이미지를 표시. -->
                        <img th:src="${festival.festivalImages.size() > 1 
                            ? festival.festivalImages[1].imageUrl 
                            : festival.festivalImages[0].imageUrl}" 
                            class="w-full h-36 object-cover rounded-lg mb-3" />

                        <h3 class="text-lg font-bold text-gray-800 mb-2" th:text="${festival.title}">축제 제목</h3>

                        <p class="text-sm text-gray-600 mb-2" th:if="${festival.addr}">
                            <i class="fas fa-map-marker-alt"></i> <span th:text="${festival.addr}">주소</span>
                        </p>
                        
                        <p class="text-sm text-gray-500 mb-2"
                            th:if="${festival.eventStartDate != null and festival.eventEndDate != null}">
                            <i class="fas fa-calendar"></i>
                            <span th:text="${#temporals.format(festival.eventStartDate, 'yyyy.MM.dd')}">시작일</span>
                            ~
                            <span th:text="${#temporals.format(festival.eventEndDate, 'yyyy.MM.dd')}">종료일</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- 현재 진행중인 축제만 보기 체크박스 -->
            <div class="flex items-center mt-4 mb-2">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="ongoingOnlyCheckbox" class="w-4 h-4 text-main border-gray-300 rounded focus:ring-main focus:ring-2 cursor-pointer">
                    <span class="ml-2 text-sm text-gray-700">현재 진행중인 축제만 보기</span>
                </label>
            </div>

            <!-- 페이지네이션 -->
            <div id="pagination" th:if="${festivalList != null and !festivalList.empty}" class="flex justify-center items-center gap-1.5 mt-4 mx-auto" style="max-width: 80%;">
                <th:block th:with="
                    total=${festivalList.totalPages},
                    current=${festivalList.number},

                    startCalc=${current - 2},
                    start=${startCalc < 0 ? 0 : (startCalc > total - 5 ? total - 5 : startCalc)},

                    start=${start < 0 ? 0 : start},
                    endCalc=${start + 4},
                    end=${endCalc >= total ? total - 1 : endCalc}
                ">
                    <!-- 이전 블록 -->
                    <a href="#" th:data-page="${current - 1 < 0 ? 0 : current - 1}" th:if="${current > 0}"
                       class="page-btn inline-flex items-center justify-center px-2 py-1.5 border rounded hover:bg-gray-100 cursor-pointer text-sm">
                        ◀
                    </a>
                    <span th:if="${current == 0}" class="inline-flex items-center justify-center px-2 py-1.5 border rounded text-gray-400 cursor-pointer text-sm">◀</span>
            
                    <!-- 첫 페이지 항상 표시 -->
                    <a href="#" th:data-page="0" th:if="${start > 0}"
                       class="page-btn inline-flex items-center justify-center px-2.5 py-1.5 border rounded hover:bg-gray-100 cursor-pointer text-sm">1</a>
                    
                    <!-- 앞에 ... 표시 -->
                    <span th:if="${start > 1}" class="px-1 text-sm">...</span>
            
                    <!-- 번호 버튼 -->
                    <a th:each="i : ${#numbers.sequence(start, end)}" href="#" th:data-page="${i}" th:text="${i + 1}"
                       th:class="${i == current} 
                            ? 'page-btn inline-flex items-center justify-center px-2.5 py-1.5 rounded bg-main text-white cursor-pointer text-sm'
                            : 'page-btn inline-flex items-center justify-center px-2.5 py-1.5 border rounded hover:bg-gray-100 cursor-pointer text-sm'">
                    </a>
            
                    <!-- 뒤에 ... 표시 -->
                    <span th:if="${end < total - 2}" class="px-1 text-sm">...</span>
            
                    <!-- 마지막 페이지 항상 표시 -->
                    <a href="#" th:data-page="${total - 1}" th:if="${end < total - 1}"
                       class="page-btn inline-flex items-center justify-center px-2.5 py-1.5 border rounded hover:bg-gray-100 cursor-pointer text-sm"
                       th:text="${total}"></a>
            
                    <!-- 다음 블록 -->
                    <a href="#" th:data-page="${current + 1 >= total ? total - 1 : current + 1}" th:if="${current < total - 1}"
                       class="page-btn inline-flex items-center justify-center px-2 py-1.5 border rounded hover:bg-gray-100 cursor-pointer text-sm">
                       ▶
                    </a>
                    <span th:if="${current >= total - 1}" class="inline-flex items-center justify-center px-2 py-1.5 border rounded text-gray-400 cursor-pointer text-sm">▶</span>
                </th:block>
            </div>                     

        </div>
    </div>

</body>
</html>