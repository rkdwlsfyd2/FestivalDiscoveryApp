<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8">
	<title>다음 지도 API</title>
</head>
<body>
	<!-- 지도 컨텐츠 fragment -->
	<div th:fragment="mapContent">
		<div id="map" style="width:750px;height:350px;"></div>
	</div>
	
	<!-- 지도 스크립트 fragment -->
	<th:block th:fragment="mapScript">
		<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=eef341c9ac4fcace57bca8636d2fcee7" 
		        onerror="console.error('카카오맵 SDK 로드 실패. API 키와 도메인 설정을 확인하세요. URL:', this.src);"
		        onload="console.log('카카오맵 SDK 스크립트 태그 로드 완료');"></script>
		<script>
			function initMap() {
				var mapContainer = document.getElementById('map');
				if (!mapContainer) {
					console.error('지도를 표시할 div를 찾을 수 없습니다.');
					return;
				}
				
				if (typeof kakao === 'undefined' || !kakao.maps) {
					console.error('카카오맵 SDK가 로드되지 않았습니다. 다음을 확인하세요:');
					console.error('1. 카카오 개발자 콘솔에서 카카오맵 사용 설정이 ON인지 확인');
					console.error('2. 사이트 도메인이 등록되어 있는지 확인');
					console.error('3. API 키가 올바른지 확인');
					return;
				}
				
				try {
					var mapOption = {
						center: new kakao.maps.LatLng(37.56682, 126.97865),
						level: 3,
						mapTypeId : kakao.maps.MapTypeId.ROADMAP
					}; 

					var map = new kakao.maps.Map(mapContainer, mapOption);
					console.log('카카오맵 초기화 완료');
				} catch (e) {
					console.error('카카오맵 초기화 중 오류:', e);
				}
			}
			
			// 스크립트가 로드될 때까지 대기
			if (document.readyState === 'loading') {
				document.addEventListener('DOMContentLoaded', function() {
					waitForKakao();
				});
			} else {
				waitForKakao();
			}
			
			function waitForKakao() {
				if (typeof kakao !== 'undefined' && kakao.maps) {
					initMap();
				} else {
					var attempts = 0;
					var maxAttempts = 50; // 5초 (100ms * 50)
					var checkInterval = setInterval(function() {
						attempts++;
						if (typeof kakao !== 'undefined' && kakao.maps) {
							clearInterval(checkInterval);
							initMap();
						} else if (attempts >= maxAttempts) {
							clearInterval(checkInterval);
							console.error('카카오맵 SDK 로드 시간 초과');
							console.error('브라우저 개발자 도구의 Network 탭에서 스크립트 로드 상태를 확인하세요.');
						}
					}, 100);
				}
			}
		</script>
	</th:block>
</body>
</html>
