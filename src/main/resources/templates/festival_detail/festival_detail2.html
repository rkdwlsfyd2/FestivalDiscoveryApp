<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  lang="ko"
	  layout:decorate="common/mylayout"> <!-- 506690, 2557842, 3379778 -->
	<head>
		<meta charset="UTF-8">
		<title>ì¶•ì œ ìƒì„¸ ë³´ê¸°</title>

		<!-- ì´ í˜ì´ì§€ ì „ìš© ìµœì†Œ CSS -->
		<style>
			/* í˜ì´ì§€ ì „ì²´ í­/ì—¬ë°± */
			.page-wrap {
				max-width: 960px;
				margin: 24px auto 80px;
				padding: 0 16px;
			}

			/* ì¹´ë“œ ì»´í¬ë„ŒíŠ¸: ë°°ê²½Â·ë¼ìš´ë“œÂ·ê·¸ë¦¼ì */
			.card {
				background: #ffffff;
				border-radius: 8px;
				padding: 24px;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
				margin-bottom: 24px;
			}

			/* ìƒíƒœ/ë¦¬ë·° ìš”ì•½ ì¤„ */
			.fd-badge-row {
				display: flex;
				gap: 8px;
				align-items: center;
				margin: 6px 0;
				flex-wrap: wrap;
			}

			/* ìƒíƒœ ë°°ì§€ ê³µí†µ */
			.fd-status-badge {
				display: inline-flex;
				align-items: center;
				padding: 4px 10px;
				border-radius: 999px;
				font-size: 12px;
				font-weight: 600;
			}

			/* ì§„í–‰ ì¤‘ / ì¢…ë£Œ ìƒ‰ìƒ (ì§„í–‰ ì˜ˆì •ì€ bg-main ìœ í‹¸ ì‚¬ìš©) */
			.fd-status-badge--ongoing {
				background: #22c55e;
				color: #ffffff;
			}

			.fd-status-badge--finished {
				background: #9ca3af;
				color: #ffffff;
			}

			/* ë‚ ì§œÂ·ì£¼ì†Œ ë©”íƒ€ ì •ë³´ */
			.fd-meta {
				font-size: 13px;
				color: #444444;
				margin-top: 4px;
			}

			.fd-meta span {
				display: inline-block;
				margin-right: 12px;
			}

			/* ì œëª© ì˜† íƒœê·¸ ì¹©: ëª¨ì–‘ë§Œ, ìƒ‰ì€ bg-sub-blue / text-main ìœ¼ë¡œ ì²˜ë¦¬ */
            .fd-tag-chip {
                display: inline-flex;
                align-items: center;
                font-size: 12px;
                padding: 3px 8px;
                border-radius: 999px;
                margin-right: 4px;
                background: #eff6ff;
                color: #1f2933;
            }

			/* ìƒë‹¨ ì¢Œ/ìš° ë ˆì´ì•„ì›ƒ */
			.fd-top-layout {
				display: flex;
				align-items: flex-start;
				gap: 24px;
				margin-top: 12px;
			}

			.fd-top-left {
				flex: 3;
			}

			.fd-top-right {
				flex: 2;
				border-left: 1px solid #f0f0f0;
				padding-left: 16px;
			}

			/* ê¸°ë³¸ ì •ë³´ ë¦¬ìŠ¤íŠ¸ */
            .fd-info-list {
                list-style: none;
                padding: 0;
                margin: 8px 0 0;
                font-size: 13px;
            }

            /* í•œ ì¤„ ì „ì²´ë¥¼ ê°€ë¡œ ì •ë ¬ */
            .fd-info-list li {
                display: flex;
                align-items: flex-start;
                margin-bottom: 6px;
            }

            /* ì™¼ìª½ ë¼ë²¨(ê¸°ê°„/ì¥ì†Œ/ì£¼ìµœ/ë¬¸ì˜/í™ˆí˜ì´ì§€) */
            .fd-info-list strong {
                flex: 0 0 60px;
                color: #555555;
            }

            /* ì˜¤ë¥¸ìª½ ê°’(í…ìŠ¤íŠ¸)ë§Œ í­ ì±„ìš°ê¸° */
            .fd-info-list span {
                flex: 1;
            }

            /* ë²„íŠ¼ì€ ë‚´ìš© ê¸¸ì´ë§Œí¼ë§Œ ë‚˜ì˜¤ë„ë¡ */
            .fd-info-list a {
                flex: 0 0 auto;
                display: inline-block;
                white-space: nowrap; /* ì¤„ë°”ê¿ˆ ë°©ì§€(ì„ íƒ) */
            }

			/* ë¦¬ë·° ì¹´ë“œ ë‚´ë¶€ */
			.fd-review-item {
				border-top: 1px solid #eeeeee;
				padding-top: 10px;
				margin-top: 10px;
			}

			.fd-review-meta {
				font-size: 12px;
				color: #777777;
				margin-bottom: 4px;
				display: inline-block;
			}

			.fd-review-text {
				margin-top: 4px;
			}

			/* ë³„ì  í‘œì‹œ ===================== */
			/* ê³µí†µ: ë³„ ì»¨í…Œì´ë„ˆ */
			.star-rating {
				display: inline-flex;
				line-height: 1;
			}

			/* ê³µí†µ: ë³„ í•œ ê°œ */
			.star {
				position: relative;
				display: inline-block;
				width: 1em;
				height: 1em;
				margin-right: 1px;
			}

			/* ê¸°ë³¸: ë¹ˆ ë³„(íšŒìƒ‰) */
			.star::before {
				content: 'â˜…';
				position: absolute;
				left: 0;
				top: 0;
				color: #e5e7eb;
			}

			/* ê½‰ ì°¬ ë³„ */
			.star-full::before {
				color: #fbbf24;
			}

			/* ë°˜ ë³„: íšŒìƒ‰ + ë…¸ë€ìƒ‰ ì ˆë°˜ */
			.star-half::before {
				color: #e5e7eb;
			}
			.star-half::after {
				content: 'â˜…';
				position: absolute;
				left: 0;
				top: 0;
				color: #fbbf24;
				width: 70%;
				overflow: hidden;
				clip-path: inset(0 30% 0 0);
			}

			/* ëª©ë¡(ì´ë¯¸ ì‘ì„±ëœ ë¦¬ë·°)ì—ì„œ ì“°ëŠ” ë³„ í¬ê¸° */
			.star-rating--list {
				font-size: 18px;
			}

			/* ë¦¬ë·° ì‘ì„± í¼ì—ì„œ ì“°ëŠ” ë³„ í¬ê¸° (ì¢€ ë” í¬ê²Œ) */
			.star-rating--input {
				font-size: 22px;
			}

			/* ë¦¬ë·° ìƒë‹¨(ì´ë¦„ Â· ë³„ì  Â· ë‚ ì§œ) í•œ ì¤„ ì •ë ¬ */
			.fd-review-header {
				display: flex;
				align-items: center;
				gap: 4px;
			}

			/* ë©”íƒ€ í…ìŠ¤íŠ¸ëŠ” ì‚´ì§ ì‘ê²Œ */
			.fd-review-header .fd-review-meta {
				margin-bottom: 0;
				font-size: 13px;
				color: #777777;
			}


			/* ì ìˆ˜ í…ìŠ¤íŠ¸ */
			.rating-value {
				font-size: 14px;
				color: #555555;
			}


			/* ì¶•ì œ ì†Œê°œ/ë‚´ìš© 2ë‹¨ ë ˆì´ì•„ì›ƒ */
			.fd-intro-layout {
				display: flex;
				align-items: flex-start;
				gap: 24px;
			}

			/* ê° ì»¬ëŸ¼ */
			.fd-intro-col {
				flex: 1;
			}

			/* í™”ë©´ì´ ì¢ìœ¼ë©´ ìœ„/ì•„ë˜ë¡œ ìŒ“ê¸° */
			@media (max-width: 768px) {
				.fd-intro-layout {
					flex-direction: column;
				}
			}

			#ratingBox .star {
				cursor: pointer;
			}


			/* ëª©ë¡ìš© ë³„ì€ í…ìŠ¤íŠ¸ë‘ baseline ì‚´ì§ ë§ì¶°ì£¼ê¸° */
			.fd-review-header .star-rating {
				font-size: 18px;      /* ì´ë¯¸ ìˆìœ¼ë‹ˆ ì¤‘ë³µì´ë©´ í•˜ë‚˜ë¡œ í•©ì³ë„ ë¨ */
				line-height: 1;
				position: relative;
				top: 1px;             /* 1~2px ì‚¬ì´ì—ì„œ ì·¨í–¥ê» ì¡°ì ˆ */
			}

			.fd-review-edit-btn {
				margin-left: auto;              /* ì˜¤ë¥¸ìª½ ëìœ¼ë¡œ ë°€ê¸° */
				padding: 2px 8px;
				font-size: 12px;
				border: 1px solid #d1d5db;
				border-radius: 4px;
				background: #ffffff;
				color: #4A80FA;
				cursor: pointer;
			}

			.fd-review-edit-btn:hover {
				background: #eff6ff;
			}

            /* íƒœê·¸ ì•„ì´ì½˜ ë¦¬ìŠ¤íŠ¸ */
            .fd-tag-icon-list {
                display: flex;
                flex-wrap: wrap;
                gap: 4px;
            }

            /* ì£¼ì†Œ í´ë¦­ ì•ˆë‚´ í† ìŠ¤íŠ¸ */
            .addr-copy-toast {
                position: fixed;
                left: 50%;
                bottom: 24px;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: #ffffff;
                padding: 8px 14px;
                border-radius: 999px;
                font-size: 13px;
                z-index: 99999;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.2s ease-in-out;
            }

            .fd-tag-chip:hover {
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .addr-copy-toast--show {
                opacity: 1;
                pointer-events: auto;
            }
        </style>

		<script>
            document.addEventListener('DOMContentLoaded', function () {
                const container = document.getElementById('imageSliderContainer');
                const prevBtn = document.getElementById('prevImageBtn');
                const nextBtn = document.getElementById('nextImageBtn');
                const info = document.getElementById('imageSliderInfo');

                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById('modalImage');
                const modalClose = document.getElementById('modalCloseBtn');
                const modalPrev = document.getElementById('modalPrevBtn');
                const modalNext = document.getElementById('modalNextBtn');

                /* ===== ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” & ëª¨ë‹¬ ===== */
                if (container) {
                    const images = container.querySelectorAll('img');
                    if (images && images.length > 0) {

                        let currentIndex = 0;

                        function showImage(index) {
                            for (let i = 0; i < images.length; i++) {
                                images[i].style.display = (i === index) ? '' : 'none';
                            }
                            if (info) {
                                info.textContent = (index + 1) + ' / ' + images.length;
                            }
                            if (modal && modal.style.display === 'flex') {
                                modalImg.src = images[index].src;
                            }
                        }

                        function openModal(index) {
                            if (!modal) return;
                            modal.style.display = 'flex';
                            modalImg.src = images[index].src;
                        }

                        function closeModal() {
                            if (!modal) return;
                            modal.style.display = 'none';
                        }

                        showImage(currentIndex);

                        if (prevBtn) {
                            prevBtn.addEventListener('click', function () {
                                currentIndex = (currentIndex - 1 + images.length) % images.length;
                                showImage(currentIndex);
                            });
                        }

                        if (nextBtn) {
                            nextBtn.addEventListener('click', function () {
                                currentIndex = (currentIndex + 1) % images.length;
                                showImage(currentIndex);
                            });
                        }

                        if (container) {
                            container.addEventListener('click', function () {
                                openModal(currentIndex);
                            });
                        }

                        if (modalClose) {
                            modalClose.addEventListener('click', function () {
                                closeModal();
                            });
                        }

                        if (modal) {
                            modal.addEventListener('click', function (e) {
                                if (e.target === modal) {
                                    closeModal();
                                }
                            });
                        }

                        if (modalPrev) {
                            modalPrev.addEventListener('click', function (e) {
                                e.stopPropagation();
                                currentIndex = (currentIndex - 1 + images.length) % images.length;
                                showImage(currentIndex);
                            });
                        }

                        if (modalNext) {
                            modalNext.addEventListener('click', function (e) {
                                e.stopPropagation();
                                currentIndex = (currentIndex + 1) % images.length;
                                showImage(currentIndex);
                            });
                        }
                    }
                }

				/* ===== ë¦¬ë·° ë³„ì  ì…ë ¥ (hover + 0.5 ë‹¨ìœ„) ===== */
				const ratingBox       = document.getElementById('ratingBox');       // ë³„ 5ê°œ ì»¨í…Œì´ë„ˆ
				const ratingInput     = document.getElementById('ratingInput');     // hidden input
				const ratingValueText = document.getElementById('ratingValueText'); // "4.5ì " í‘œì‹œìš©

                if (ratingBox && ratingInput) {
                    const stars = ratingBox.querySelectorAll('.star');
                    let currentRating = parseFloat(ratingInput.value || '0') || 0;

                    function paintStars(rating) {
                        stars.forEach(star => {
                            const i = Number(star.getAttribute('data-index')); // 1~5
                            star.classList.remove('star-full', 'star-half', 'star-empty');

                            if (rating >= i) {
                                star.classList.add('star-full');
                            } else if (rating >= i - 0.5) {
                                star.classList.add('star-half');
                            } else {
                                star.classList.add('star-empty');
                            }
                        });

                        if (ratingValueText) {
                            if (rating <= 0) {
                                ratingValueText.textContent = '';
                                return;
                            }

                            let msg = '';
                            if (rating >= 4.5)      msg = 'ì•„ì£¼ ì¢‹ì•„ìš” ğŸ‘';
                            else if (rating >= 3.5) msg = 'ì¢‹ì•„ìš” ğŸ™‚';
                            else if (rating >= 2.5) msg = 'ë³´í†µì´ì—ìš” ğŸ˜';
                            else                    msg = 'ì¡°ê¸ˆ ì•„ì‰¬ì›Œìš” ğŸ˜¢';

                            ratingValueText.textContent = `${msg} (${rating.toFixed(1)}ì )`;
                        }
                    }

                    function calcRatingFromEvent(star, event) {
                        const index = Number(star.getAttribute('data-index'));
                        const rect  = star.getBoundingClientRect();
                        const x     = event.clientX - rect.left;
                        const half  = rect.width / 2;

                        return (x <= half) ? (index - 0.5) : index;
                    }

                    // ì´ˆê¸° í‘œì‹œ
                    paintStars(currentRating);

                    stars.forEach(star => {
                        star.addEventListener('mousemove', e => {
                            const hoverRating = calcRatingFromEvent(star, e);
                            paintStars(hoverRating);
                        });

                        star.addEventListener('click', e => {
                            const newRating = calcRatingFromEvent(star, e);
                            currentRating   = newRating;
                            ratingInput.value = newRating;
                            paintStars(newRating);
                        });
                    });

                    ratingBox.addEventListener('mouseleave', () => {
                        paintStars(currentRating);
                    });
                }




                // ===== ì¶•ì œ ë‚´ìš© ì¤„ë°”ê¿ˆ ì²˜ë¦¬ (1. 2. 3. â€¦) =====
				const contentEl = document.getElementById('festivalContent');
				if (contentEl) {
					const raw = contentEl.textContent || '';

					// " 2.", " 3.", " 4.", " 5." ì•ì— <br>
					const formatted = raw.replace(/\s([2-9]\.\s)/g, '<br>$1');

					// HTMLë¡œ ë„£ì–´ì„œ ì¤„ë°”ê¿ˆ ë°˜ì˜
					contentEl.innerHTML = formatted;
				}

				// ===== ë¦¬ë·° í˜ì´ì§• AJAX ì²˜ë¦¬ =====
				const reviewListWrapper = document.getElementById('reviewListWrapper');

				if (reviewListWrapper) {
					// ì´ë²¤íŠ¸ ìœ„ì„(event delegation)
					reviewListWrapper.addEventListener('click', function (e) {
						const link = e.target.closest('.review-page-link');
						if (!link) return;  // í˜ì´ì§• ë§í¬ê°€ ì•„ë‹ˆë©´ ë¬´ì‹œ

						e.preventDefault();

						let url = link.getAttribute('href');
						if (!url) return;

						// ajax=1 íŒŒë¼ë¯¸í„° ì¶”ê°€ (ì´ë¯¸ ìˆìœ¼ë©´ ì¤‘ë³µ ì¶”ê°€ ë°©ì§€)
						if (url.indexOf('ajax=1') === -1) {
							url += (url.indexOf('?') === -1 ? '?ajax=1' : '&ajax=1');
						}

						fetch(url, {
							method: 'GET',
							headers: {
								'X-Requested-With': 'XMLHttpRequest'
							}
						})
								.then(function (res) {
									if (!res.ok) {
										throw new Error('HTTP ' + res.status);
									}
									return res.text();
								})
								.then(function (html) {
									// í”„ë˜ê·¸ë¨¼íŠ¸ HTMLë¡œ ë¦¬ë·° ì˜ì—­ ê°ˆì•„ë¼ìš°ê¸°
									reviewListWrapper.innerHTML = html;

									// ìŠ¤í¬ë¡¤ì„ ë¦¬ë·° ì¹´ë“œ ìœ„ë¡œ ì‚´ì§ ì˜¬ë ¤ì£¼ê¸° (ì„ íƒ)
									const reviewSection = document.getElementById('reviewSection');
									if (reviewSection) {
										reviewSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
									}
								})
								.catch(function (err) {
									console.error('ë¦¬ë·° í˜ì´ì§€ ë¡œë”© ì‹¤íŒ¨', err);
								});
					});
				}

                // ===== ì£¼ì†Œ í´ë¦­ -> ë³µì‚¬ + í† ìŠ¤íŠ¸ ì•Œë¦¼ =====
                const addrEl   = document.getElementById('festivalAddrText');
                const toastEl  = document.getElementById('addrCopyToast');
                let toastTimer = null;

                if (addrEl) {
                    addrEl.addEventListener('click', function () {
                        const text = (addrEl.textContent || '').trim();
                        if (!text) return;

                        // Clipboard API ìš°ì„  ì‹œë„
                        if (navigator.clipboard && navigator.clipboard.writeText) {
                            navigator.clipboard.writeText(text)
                                .then(function () {
                                    showAddrToast();
                                })
                                .catch(function (err) {
                                    console.error('Clipboard API ì‹¤íŒ¨', err);
                                    fallbackCopy(text);
                                });
                        } else {
                            // êµ¬í˜• ë¸Œë¼ìš°ì € fallback
                            fallbackCopy(text);
                        }
                    });
                }

                function fallbackCopy(text) {
                    const temp = document.createElement('textarea');
                    temp.value = text;
                    temp.style.position = 'fixed';
                    temp.style.top = '-9999px';
                    document.body.appendChild(temp);
                    temp.select();

                    try {
                        document.execCommand('copy');
                        showAddrToast();
                    } catch (e) {
                        console.error('execCommand copy ì‹¤íŒ¨', e);
                        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');
                    } finally {
                        document.body.removeChild(temp);
                    }
                }

                function showAddrToast() {
                    if (!toastEl) {
                        alert('ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        return;
                    }

                    // ì´ë¯¸ ë–  ìˆëŠ” ìƒíƒœë©´ íƒ€ì´ë¨¸ ë¦¬ì…‹
                    if (toastTimer) {
                        clearTimeout(toastTimer);
                        toastTimer = null;
                    }

                    toastEl.classList.add('addr-copy-toast--show');

                    // 1.2ì´ˆ ë’¤ì— ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ë¼ì§€ê²Œ
                    toastTimer = setTimeout(function () {
                        toastEl.classList.remove('addr-copy-toast--show');
                    }, 1200);
                }
			});
		</script>
	</head>
	<body>
		<section layout:fragment="content" class="festival-detail-page">
			<div class="page-wrap">

				<!-- A. ìƒë‹¨: ì œëª© + íƒœê·¸ + ìƒíƒœ + (ì™¼)ì´ë¯¸ì§€ / (ì˜¤ë¥¸ìª½)ê¸°ë³¸ì •ë³´ -->
				<div class="card">
					<header>
						<!-- 1. ì¶•ì œëª…, íƒœê·¸, ì¦ê²¨ì°¾ê¸° -->
						<div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
							<!-- ì¶•ì œëª… -->
							<div th:if="${isAdmin}">
								<input type="text"
									   name="title"
									   th:value="${festival.title}"
									   class="border px-3 py-1 rounded w-full"/>
							</div>
							<div th:if="${!isAdmin}">
								<h1 class="text-h1 font-bold" th:text="${festival.title}"></h1>
							</div>


							<!-- íƒœê·¸ -->
							<div class="fd-tag-icon-list">
								<span class="fd-tag-chip bg-sub-blue"
									  th:each="tag : ${festival.tags}">
									<span th:switch="${tag.tag}">

										<!-- ğŸŒ¿ ìì—° -->
										<span th:case="'ìì—°'">ğŸŒ¿ ìì—°</span>

										<!-- ğŸŒ™ ì•¼ê°„ -->
										<span th:case="'ì•¼ê°„'">ğŸŒ™ ì•¼ê°„</span>

										<!-- ğŸ¨ ì²´í—˜ -->
										<span th:case="'ì²´í—˜'">ğŸ¨ ì²´í—˜</span>

										<!-- ğŸœ ë¨¹ê±°ë¦¬ -->
										<span th:case="'ë¨¹ê±°ë¦¬'">ğŸœ ë¨¹ê±°ë¦¬</span>

										<!-- ğŸ­ ë¬¸í™” -->
										<span th:case="'ë¬¸í™”'">ğŸ­ ë¬¸í™”</span>

										<!-- ğŸ‘¦ ì•„ë™ -->
										<span th:case="'ì•„ë™'">ğŸ‘¦ ì•„ë™</span>

										<!-- â„ï¸ ê³„ì ˆ -->
										<span th:case="'ê³„ì ˆ'">â„ï¸ ê³„ì ˆ</span>
									</span>
								</span>
							</div>

							<!-- ì¦ê²¨ì°¾ê¸° í† ê¸€ ë²„íŠ¼ -->
							<form method="post" th:action="@{/favorite/toggle}">
								<input type="hidden" name="festivalNo" th:value="${festival.festivalNo}">

								<!-- í˜„ì¬ ìƒì„¸ í˜ì´ì§€ë¡œ ë‹¤ì‹œ ëŒì•„ì˜¤ë„ë¡ redirectUrl ì„¤ì • -->
								<input type="hidden" name="redirectUrl" th:value="@{|/festivals/detail?festivalNo=${festival.festivalNo}&page=${currentPage}|}">

								<button type="submit" class="text-[12px] px-2 py-1 rounded-lg border" th:classappend="${isFavorite} ? ' bg-yellow-300 border-yellow-400' : ' border-gray-300'" th:text="${isFavorite} ? 'â˜…' : 'â˜†'"></button>
							</form>
						</div>

						<!-- 2. ì§„í–‰ ìƒíƒœ, ë¦¬ë·° ìš”ì•½ -->
						<div class="fd-badge-row">
							<!-- ì§„í–‰ ìƒíƒœ -->
							<th:block th:with="today=${T(java.time.LocalDate).now()},
											   start=${festival.eventStartDate.toLocalDate()},
											   end=${festival.eventEndDate.toLocalDate()}">
								<!-- ì§„í–‰ ì˜ˆì • -->
								<span class="fd-status-badge bg-main text-foreground" th:if="${today.isBefore(start)}">
									ì¶•ì œ ì§„í–‰ ì˜ˆì •
								</span>

								<!-- ì§„í–‰ ì¤‘ -->
								<span class="fd-status-badge fd-status-badge--ongoing" th:if="${!today.isBefore(start) and !today.isAfter(end)}">
									ì¶•ì œ ì§„í–‰ ì¤‘
								</span>
								<!-- ì¢…ë£Œ -->
								<span class="fd-status-badge fd-status-badge--finished" th:if="${today.isAfter(end)}">
									ì¶•ì œ ì¢…ë£Œ
								</span>
							</th:block>

							<!-- ë¦¬ë·° ìš”ì•½ -->
							<span class="text-subtext" th:text="|â­ ${#numbers.formatDecimal(festival.avgRating, 1, 1)} / 5.0|"></span>
							<span class="text-subtext text-gray-600" th:text="|ë¦¬ë·° (${festival.reviews.size()}ê°œ)|"></span>
						</div>
					</header>

					<div class="fd-top-layout">
						<!-- 3. ì´ë¯¸ì§€ ìŠ¬ë¼ì´ë” -->
						<div class="fd-top-left">
							<section>
								<div style="width: 100%;
											max-width: 420px;
											margin: 0 auto;
											display: flex;
											align-items: center;
											justify-content: center;">
									<button th:if="${festival.images != null and #lists.size(festival.images) > 1}" type="button" id="prevImageBtn" style="margin-right: 8px;">â—€</button>

									<div id="imageSliderContainer"
										 style="width: 100%;
												height: 260px;
												display: flex;
												align-items: center;
												justify-content: center;
												overflow: hidden;
												cursor: pointer;"
										 th:styleappend="${festival.images == null or #lists.isEmpty(festival.images)} ? 'background:#e5e7eb;' : 'background:#000000;'">
										<th:block th:if="${festival.images == null or #lists.isEmpty(festival.images)}">
											<span class="text-xs text-gray-600">ì´ë¯¸ì§€ ì—†ìŒ</span>
										</th:block>
										<img th:if="${festival.images != null}"
											 th:each="image : ${festival.images}"
											 th:src="${image.imageUrl}"
											 th:alt="${image.imageUrl}"
											 style="max-width: 100%;
													max-height: 100%;
													width: auto;
													height: auto;">
									</div>

									<button th:if="${festival.images != null and #lists.size(festival.images) > 1}" type="button" id="nextImageBtn" style="margin-left: 8px;">â–¶</button>
								</div>

								<p id="imageSliderInfo"
								   class="text-subtext"
								   style="text-align: center;
										  margin-top: 6px;
										  color: #666666;"></p>

								<!-- ëª¨ë‹¬ -->
								<div id="imageModal"
									 style="display: none;
											position: fixed;
											left: 0;
											top: 0;
											width: 100%;
											height: 100%;
											background: rgba(0,0,0,0.7);
											z-index: 9999;
											align-items: center;
											justify-content: center;">
									<button id="modalCloseBtn"
											type="button"
											style="position: absolute;
												   top: 16px;
												   right: 24px;
												   font-size: 24px;
												   border: none;
												   background: none;
												   color: #ffffff;
												   cursor: pointer;">
										âœ•
									</button>

									<button id="modalPrevBtn"
											type="button"
											style="position: absolute;
												   left: 16px;
												   font-size: 32px;
												   border: none;
												   background: none;
												   color: #ffffff;
												   cursor: pointer;">
										â—€
									</button>

									<button id="modalNextBtn"
											type="button"
											style="position: absolute;
												   right: 16px;
												   font-size: 32px;
												   border: none;
												   background: none;
												   color: #ffffff;
												   cursor: pointer;">
										â–¶
									</button>

									<img id="modalImage"
										 src=""
										 alt="ì›ë³¸ ì´ë¯¸ì§€"
										 style="max-width: 90%;
												max-height: 90%;
												box-shadow: 0 0 12px rgba(0,0,0,0.5);
												background: #ffffff;">
								</div>
							</section>
						</div>

						<!-- ì¼ë°˜ ì‚¬ìš©ììš© : ê¸°ë³¸ ì •ë³´ í‘œì‹œ -->
						<div class="fd-top-right" th:if="${!isAdmin}">
							<section>
								<h2 class="text-h3 font-semibold mb-2">ê¸°ë³¸ ì •ë³´</h2>
								<ul class="fd-info-list">
									<li>
										<strong>ê¸°ê°„</strong>
										<span th:text="|${festival.eventStartDate.toLocalDate()} ~ ${festival.eventEndDate.toLocalDate()}|"></span>
									</li>
									<li>
										<strong>ì¥ì†Œ</strong>
										<span th:text="${festival.addr}"></span>
									</li>
									<li>
										<strong>ìš”ê¸ˆ</strong>
										<span th:text="${festival.detail.festivalFee}"></span>
									</li>
									<li>
										<strong>ì£¼ìµœ</strong>
										<span th:text="${festival.detail.host}"></span>
									</li>
									<li>
										<strong>ë¬¸ì˜</strong>
										<span th:text="${festival.detail.hostTel}"></span>
									</li>
									<li th:if="${festival.detail.homepage != null}">
										<strong>í™ˆí˜ì´ì§€</strong>
										<a th:href="${festival.detail.homepage}"
										   target="_blank"
										   class="text-subtext text-foreground bg-main"
										   style="display:inline-block;
												  margin-left:4px;
												  padding:6px 10px;
												  border-radius:4px;
												  text-decoration:none;">
											í™ˆí˜ì´ì§€ ë°”ë¡œê°€ê¸°
										</a>
									</li>
								</ul>
							</section>
						</div>

						<!-- ê´€ë¦¬ììš© : ìˆ˜ì • í¼ -->
						<form th:if="${isAdmin}"
							  th:action="@{/admin/festivals/update}"
							  method="post"
							  id="festivalEditForm"
							  style="margin-top:20px;">

							<input type="hidden" name="festivalNo" th:value="${festival.festivalNo}" />

							<div class="fd-top-right">
								<section>
									<h2 class="text-h3 font-semibold mb-2">ê¸°ë³¸ ì •ë³´ (ê´€ë¦¬ì ìˆ˜ì •)</h2>
									<ul class="fd-info-list">
										<li>
											<strong>ê¸°ê°„</strong>
											<div class="flex items-center gap-2">
												<input type="date"
													   name="eventStartDate"
													   th:value="${festival.eventStartDate.toLocalDate()}"
													   class="border rounded px-2 py-1" />
												<span>~</span>
												<input type="date"
													   name="eventEndDate"
													   th:value="${festival.eventEndDate.toLocalDate()}"
													   class="border rounded px-2 py-1" />
											</div>
										</li>

										<li>
											<strong>ì¥ì†Œ</strong>
											<input type="text"
												   name="addr"
												   th:value="${festival.addr}"
												   class="border rounded px-2 py-1 w-full" />
										</li>

										<li>
											<strong>ìš”ê¸ˆ</strong>
											<input type="text"
												   name="festivalFee"
												   th:value="${festival.detail.festivalFee}"
												   class="border rounded px-2 py-1 w-full" />
										</li>

										<li>
											<strong>ì£¼ìµœ</strong>
											<input type="text"
												   name="host"
												   th:value="${festival.detail.host}"
												   class="border rounded px-2 py-1 w-full" />
										</li>

										<li>
											<strong>ë¬¸ì˜</strong>
											<input type="text"
												   name="hostTel"
												   th:value="${festival.detail.hostTel}"
												   class="border rounded px-2 py-1 w-full" />
										</li>

										<li>
											<strong>í™ˆí˜ì´ì§€</strong>
											<input type="url"
												   name="homepage"
												   th:value="${festival.detail.homepage}"
												   class="border rounded px-2 py-1 w-full" />
										</li>
									</ul>
								</section>
							</div>

						</form>


					</div>
				</div>

				<!-- B. ë¦¬ë·° -->
				<div class="card" id="reviewSection">
					<h2 class="text-h3 font-semibold mb-3">ë¦¬ë·°</h2>

					<!-- AJAX -->
					<div id="reviewListWrapper">
						<!-- í”„ë˜ê·¸ë¨¼íŠ¸ ì •ì˜ -->
						<th:block th:fragment="reviewListFragment">

							<!-- í‰ê·  í‰ì /ë¦¬ë·° ê°œìˆ˜ -->
							<p class="text-body" style="margin-bottom: 8px;">
								í‰ê·  í‰ì 
								<strong th:text="|â­ ${#numbers.formatDecimal(festival.avgRating, 1, 1)} / 5.0 Â· ë¦¬ë·° ${totalReviews}ê°œ|"></strong>
							</p>

							<!-- í˜ì´ì§•ëœ ë¦¬ë·° ëª©ë¡ -->
							<div class="fd-review-item" th:each="review : ${reviewPage.content}">
								<div class="fd-review-header">
									<span class="fd-review-meta" th:text="${review.member.name}"></span>
									<span class="fd-review-meta">Â·</span>

									<!-- ë³„ì  -->
									<span class="star-rating star-rating--list">
										<span th:each="i : ${#numbers.sequence(1,5)}">
											<span class="star star-full"
												  th:if="${review.rating >= i}"></span>
											<span class="star star-half"
												  th:if="${review.rating < i and review.rating >= i - 0.5}"></span>
											<span class="star star-empty"
												  th:if="${review.rating < i - 0.5}"></span>
										</span>
									</span>

									<span class="fd-review-meta">Â·</span>
									<span class="fd-review-meta"
										  th:if="${review.updatedAt == null}"
										  th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></span>
									<span class="fd-review-meta"
										  th:if="${review.updatedAt != null}"
										  th:text="${#temporals.format(review.updatedAt, 'yyyy-MM-dd HH:mm:ss')}"></span>

									<!-- ìˆ˜ì • ë²„íŠ¼ -->
									<button type="button"
											th:if="${loginUser != null and loginUser.userNo == review.member.userNo}"
											th:onclick="|location.href='@{/mypage/reviews(reviewNo=${review.reviewNo})}'|"
											class="fd-review-edit-btn">
										ìˆ˜ì •í•˜ê¸°
									</button>
								</div>
								<div class="fd-review-text text-body" th:text="${review.content}"></div>
							</div>

							<!-- ë¦¬ë·° í˜ì´ì§• ë²„íŠ¼ -->
							<div class="pagination" th:if="${totalPages > 1}"
								 style="margin-top:16px; text-align:center; font-size:13px;">

								<!-- ì´ì „ ë²„íŠ¼ -->
								<a th:if="${currentPage > 0}"
								   th:href="@{|/festivals/detail?festivalNo=${festival.festivalNo}&page=${currentPage - 1}|}"
								   class="review-page-link"
								   style="display:inline-block;
										  margin:0 4px;
										  padding:4px 8px;
										  border:1px solid #e5e7eb;
										  border-radius:4px;
										  text-decoration:none;">
													ì´ì „
								</a>

								<!-- í˜ì´ì§€ ë²ˆí˜¸ -->
								<span th:each="p : ${#numbers.sequence(0, totalPages - 1)}"
									  style="display:inline-block; margin:0 2px;">
									<a th:if="${p != currentPage}"
									   th:href="@{|/festivals/detail?festivalNo=${festival.festivalNo}&page=${p}|}"
									   th:text="${p + 1}"
									   class="review-page-link"
									   style="display:inline-block; padding:4px 8px;
											  border:1px solid #e5e7eb; border-radius:4px;
											  text-decoration:none;">
									</a>
									<span th:if="${p == currentPage}"
										  th:text="${p + 1}"
										  style="display:inline-block; padding:4px 8px;
												 border:1px solid #4A80FA; border-radius:4px;
												 background:#4A80FA; color:#ffffff;">
									</span>
								</span>

								<!-- ë‹¤ìŒ ë²„íŠ¼ -->
								<a th:if="${currentPage < totalPages - 1}"
								   th:href="@{|/festivals/detail?festivalNo=${festival.festivalNo}&page=${currentPage + 1}|}"
								   class="review-page-link"
								   style="display:inline-block;
										  margin:0 4px;
										  padding:4px 8px;
										  border:1px solid #e5e7eb;
										  border-radius:4px;
										  text-decoration:none;">
													ë‹¤ìŒ
								</a>
							</div>
						</th:block>
					</div>
					<!-- AJAX ì˜ì—­ ë -->

					<!-- êµ¬ë¶„ì„  -->
					<hr style="margin: 16px 0; border: none; border-top: 1px solid #eeeeee;">

					<!-- ë¦¬ë·° ì‘ì„± í¼ -->
					<h3 th:if="${loginUser != null and !hasMyReview}" class="text-h3 font-semibold mb-2">
						ë¦¬ë·° ì‘ì„±
					</h3>

					<!-- ë¦¬ë·° ì‘ì„± í¼ -->
					<form th:if="${loginUser != null and !hasMyReview}" th:action="@{/festivals/review(festivalNo=${festival.festivalNo}, memberNo=${loginUser.userNo})}" method="post" class="space-y-3">
						<!-- ë³„ì  ì„ íƒ (.5 ë‹¨ìœ„) -->
						<div class="text-body" style="margin-bottom: 8px;">
							<!-- ë³„ì  ì…ë ¥ ì˜ì—­ -->
							<div style="display:flex; align-items:center; gap:8px; margin-bottom:12px;">
								<label class="text-subtext">ë³„ì </label>
								<div id="ratingBox" class="star-rating star-rating--input">
									<span class="star" data-index="1"></span>
									<span class="star" data-index="2"></span>
									<span class="star" data-index="3"></span>
									<span class="star" data-index="4"></span>
									<span class="star" data-index="5"></span>
								</div>
								<!-- í˜„ì¬ ì„ íƒëœ ì ìˆ˜ í‘œì‹œ -->
								<span id="ratingValueText" class="text-subtext"></span>
								<!-- ì‹¤ì œ ì„œë²„ë¡œ ë³´ë‚´ëŠ” ê°’ -->
								<input type="hidden" id="ratingInput" name="rating" value="0">
							</div>
						</div>
						<!-- ë‚´ìš© ì…ë ¥ -->
						<div class="text-body">
							<label class="text-subtext block mb-1">ë‚´ìš©</label>
							<textarea name="content" rows="2" class="w-full border rounded px-3 py-2 text-body" placeholder="ì¶•ì œì— ëŒ€í•œ í›„ê¸°ë¥¼ ììœ ë¡­ê²Œ ë‚¨ê²¨ ì£¼ì„¸ìš”."></textarea>
						</div>
						<!-- ì œì¶œ ë²„íŠ¼ -->
						<div>
							<button type="submit" class="bg-main text-foreground text-subtext px-4 py-2 rounded"> ë¦¬ë·° ë“±ë¡ </button>
						</div>
					</form>

					<!-- ì´ë¯¸ ë¦¬ë·°ê°€ ìˆëŠ” ê²½ìš° -->
					<div th:if="${loginUser != null and hasMyReview}"
						 class="text-subtext"
						 style="margin-top: 8px;">
						ì´ë¯¸ ì´ ì¶•ì œì— ëŒ€í•œ ë¦¬ë·°ë¥¼ ì‘ì„±í•˜ì…¨ì–´ìš”.
						<a th:href="@{/mypage/reviews}" style="color: cornflowerblue">ë§ˆì´í˜ì´ì§€</a>ì—ì„œ ìˆ˜ì •í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
					</div>
					<!-- ë¡œê·¸ì¸ì´ ì•ˆëœê²½ìš° -->
					<div th:if="${loginUser == null}"
						 class="text-subtext"
						 style="margin-top: 8px;">
						ë¦¬ë·° ì‘ì„±ì„ ìœ„í•´ <a th:href="@{/login}" style="color: cornflowerblue">ë¡œê·¸ì¸</a>í•˜ì„¸ìš”
					</div>
				</div>


				<!-- C. ì¶•ì œ ì†Œê°œ -->
				<div class="card">
					<div class="fd-intro-layout">
						<!-- ì™¼ìª½: ì¶•ì œ ì†Œê°œ (infotext1) -->
						<section class="fd-intro-col">
							<h2 class="text-h3 font-semibold mb-3">ì¶•ì œ ì†Œê°œ</h2>
							<div th:if="${isAdmin}">
								<textarea name="infotext1"
										  class="border w-full p-2 rounded"
										  rows="6"
										  th:text="${festival.detail.infotext1}"></textarea>
							</div>
							<div th:if="${!isAdmin}">
								<div class="text-body" th:text="${festival.detail.infotext1}"></div>
							</div>

						</section>

						<!-- ì˜¤ë¥¸ìª½: ì¶•ì œ ë‚´ìš© (infotext2 ìˆì„ ë•Œë§Œ) -->
						<section class="fd-intro-col"
								 th:if="${isAdmin or (festival.detail.infotext2 != null and !#strings.isEmpty(festival.detail.infotext2))}">
							<h2 class="text-h3 font-semibold mb-3">ì¶•ì œ ë‚´ìš©</h2>

							<!-- ê´€ë¦¬ì: ì¸ë¼ì¸ ìˆ˜ì •ìš© textarea -->
							<div th:if="${isAdmin}">
								<textarea id="festival_Content"
										  name="infotext2"
										  class="text-body border w-full rounded-md p-2"
										  rows="6"
										  th:text="${festival.detail.infotext2}"></textarea>
							</div>

							<!-- ì¼ë°˜ ì‚¬ìš©ì: ê¸°ì¡´ì²˜ëŸ¼ í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ -->
							<p th:if="${!isAdmin}"
							   id="festivalContent"
							   class="text-body"
							   th:text="${festival.detail.infotext2}"></p>
						</section>

					</div>
				</div>


				<!-- D. ìœ„ì¹˜ ì•ˆë‚´ -->
				<div class="card">
					<h2 class="text-h3 font-semibold mb-3">ìœ„ì¹˜ ì•ˆë‚´</h2>
					<div id="map" style="width:100%; height:260px;"></div>
					<script th:src="@{|https://dapi.kakao.com/v2/maps/sdk.js?appkey=${@environment.getProperty('kakao.javascript-key')}|}"></script>
					<script th:inline="javascript">
						document.addEventListener('DOMContentLoaded', function () {
							var container = document.getElementById('map');
							if (!container) return;

							var options = {
								center: new kakao.maps.LatLng([[${festival.mapy}]], [[${festival.mapx}]]),
								level: 3,
								draggable: false
							};

							var map = new kakao.maps.Map(container, options);

							var markerPosition = new kakao.maps.LatLng([[${festival.mapy}]], [[${festival.mapx}]]);

							var marker = new kakao.maps.Marker({
								position: markerPosition
							});

							marker.setMap(map);
						});
					</script>

					<!-- ì£¼ì†Œ, ë³µì‚¬-->
					<p id="festivalAddrText"
					   class="text-subtext"
					   style="margin-top: 8px; color: #555555; cursor: pointer;"
					   title="ì£¼ì†Œë¥¼ í´ë¦­í•˜ë©´ ë³µì‚¬ë©ë‹ˆë‹¤."
					   th:text="${festival.addr}">
					</p>
					<p class="text-subtext"
					   style="font-size: 11px; color: #9ca3af; margin-top: 2px;">
						ì£¼ì†Œë¥¼ í´ë¦­í•˜ë©´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤.
					</p>

					<!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
					<div id="addrCopyToast" class="addr-copy-toast">
						ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.
					</div>

				</div>
			</div>

			<!-- í˜ì´ì§€ í•˜ë‹¨ ìˆ˜ì • ë²„íŠ¼ (ê´€ë¦¬ì ì „ìš©) -->
			<div th:if="${isAdmin}"
				 style="text-align:center; margin-top:24px;">
				<button type="submit"
						form="festivalEditForm"
						class="mt-6 px-4 py-2 bg-blue-600 text-white rounded">
					ìˆ˜ì •í•˜ê¸°
				</button>
			</div>
		</section>

	</body>
</html>
