<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/mylayout}">

<head>
    <title>리뷰 관리</title>

    <th:block layout:fragment="css">
        <style>
            .review-header, .review-row {
                display: grid;
                grid-template-columns: 80px 120px 150px 1fr 80px 160px 120px;
                padding: 12px 0;
                align-items: center;
            }

            .review-header {
                font-weight: 700;
                border-bottom: 2px solid #d1d5db;
                padding: 14px 0;
            }

            .review-row {
                border-bottom: 1px solid #e5e7eb;
            }

            .review-row:hover {
                background-color: #f8fafc;
            }

            .ellipsis {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 450px;
            }
        </style>
    </th:block>
</head>

<div layout:fragment="content" class="bg-gray-50 min-h-screen mt-32">

    <div class="flex max-w-4xl mx-auto py-10">

        <!-- 관리자 사이드바 -->
        <aside class="w-60 bg-white shadow-md rounded-lg p-6 mr-8 whitespace-nowrap">
            <h2 class="text-xl font-bold mb-6">관리자 페이지</h2>

            <nav class="flex flex-col space-y-3">
                <a href="/admin"
                   class="px-3 py-2 rounded-md"
                   th:classappend="${activeMenu} == 'dashboard' ? ' bg-gray-200 font-semibold' : ' hover:bg-gray-100'">
                    대시보드
                </a>

                <a href="/admin/members"
                   class="px-3 py-2 rounded-md"
                   th:classappend="${activeMenu} == 'members' ? ' bg-gray-200 font-semibold' : ' hover:bg-gray-100'">
                    회원 관리
                </a>

                <a href="/admin/festivals"
                   class="px-3 py-2 rounded-md"
                   th:classappend="${activeMenu} == 'festivals' ? ' bg-gray-200 font-semibold' : ' hover:bg-gray-100'">
                    축제 관리
                </a>

                <a href="/admin/reviews"
                   class="px-3 py-2 rounded-md bg-gray-200 font-semibold"
                   th:classappend="${activeMenu} == 'reviews' ? ' bg-gray-200 font-semibold' : ' hover:bg-gray-100'">
                    리뷰 관리
                </a>
            </nav>
        </aside>

        <!-- 본문 -->
        <main class="flex-1">

            <div class="bg-white shadow-md rounded-xl p-6 w-full max-w-[1300px] mx-auto">
                <h2 class="text-2xl font-bold mb-6">리뷰 관리</h2>

                <!-- 검색 및 필터 -->
                <form th:action="@{/admin/reviews}" method="get"
                      class="flex flex-wrap gap-3 items-center mb-6 text-sm">

                    <input type="text" name="keyword"
                           class="border rounded-md px-3 py-2 w-48"
                           placeholder="아이디 / 리뷰 내용"
                           th:value="${keyword}">

                    <select name="sort"
                            class="border rounded-md px-3 py-2">
                        <option value="" th:selected="${sort == null}">정렬 없음</option>
                        <option value="ratingAsc" th:selected="${sort == 'ratingAsc'}">평점 오름차순</option>
                        <option value="ratingDesc" th:selected="${sort == 'ratingDesc'}">평점 내림차순</option>
                    </select>

                    <button type="submit"
                            class="px-4 py-2 bg-main text-white rounded-md">검색</button>
                </form>

                <!-- 리스트 헤더 -->
                <div class="review-header text-gray-700 text-sm">
                    <div>번호</div>
                    <div>유저 ID</div>
                    <div>축제명</div>
                    <div>리뷰 내용</div>
                    <div>평점</div>
                    <div>작성일</div>
                    <div class="text-center">관리</div>
                </div>

                <!-- 리뷰 리스트 -->
                <div th:each="r : ${reviews}" class="review-row text-sm whitespace-nowrap">

                    <div th:text="${r.reviewId}"></div>
                    <div th:text="${r.userId}"></div>
                    <div th:text="${r.festivalTitle}"></div>

                    <div class="ellipsis" th:text="${r.content}"></div>

                    <div th:text="${r.rating}"></div>

                    <div th:text="${#temporals.format(r.createdAt, 'yyyy-MM-dd')}"></div>

                    <div class="text-center">
                        <form th:action="@{'/admin/reviews/' + ${r.reviewId} + '/delete'}"
                              method="post" onsubmit="return confirm('리뷰를 삭제하시겠습니까?');">
                            <button class="px-2 py-1 border rounded text-xs text-red-600">삭제</button>
                        </form>
                    </div>
                </div>

                <!-- 조회된 리뷰 없는 경우 -->
                <div th:if="${#lists.isEmpty(reviews)}"
                     class="py-6 text-center text-gray-500">
                    조회된 리뷰가 없습니다.
                </div>

                <!-- 페이징 -->
                <div class="mt-6 flex justify-center space-x-2">

                    <a th:if="${(page ?: 0) > 0}"
                       th:href="@{/admin/reviews(page=${(page ?: 0)-1}, sort=${sort}, keyword=${keyword})}"
                       class="px-3 py-1 border rounded-md">이전</a>

                    <span class="px-4 py-2 font-semibold bg-gray-100 rounded-md">
                        [[${(page ?: 0)+1}]] / [[${totalPages ?: 1}]]
                    </span>

                    <a th:if="${(page ?: 0)+1 < (totalPages ?: 1)}"
                       th:href="@{/admin/reviews(page=${(page ?: 0)+1}, sort=${sort}, keyword=${keyword})}"
                       class="px-3 py-1 border rounded-md">다음</a>

                </div>


            </div>
        </main>
    </div>
</div>

</html>
